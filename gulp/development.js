
//////////////////////////////////////////////////////////////////////////////////////////////
// Required files
//////////////////////////////////////////////////////////////////////////////////////////////


var gulp = require('gulp');
var shell = require('gulp-shell');
var rimraf = require('rimraf');
var run = require('run-sequence');
var watch = require('gulp-watch');
var server = require('gulp-live-server');


//////////////////////////////////////////////////////////////////////////////////////////////
// Vars setup
//////////////////////////////////////////////////////////////////////////////////////////////
var express;

//////////////////////////////////////////////////////////////////////////////////////////////
// BE task
//////////////////////////////////////////////////////////////////////////////////////////////


gulp.task('server', function(){
  express = server.new('./server/build');
  express.start.bind(express);
});

gulp.task('build', function(cb){
  run('clean', 'babel', 'restart', cb);
});

gulp.task('clean', function(cb){
  rimraf('./server/build', cb);
});

gulp.task('babel', shell.task([
    'babel ./server/src --out-dir ./server/build'
  ])
);

gulp.task('restart', function(){
  express.start.bind(express)();
});


gulp.task('watch-be', function(){
  gulp.watch('./server/src/**/*.js', function(){
    gulp.start('build');
  });
})

//////////////////////////////////////////////////////////////////////////////////////////////
// Commands
//////////////////////////////////////////////////////////////////////////////////////////////

gulp.task('development', function(cb){
  // off FE build  ==== run('server', 'build', 'watch-be', 'watch-fe', 'clean-scripts', 'traslate-scripts', 'less', cb);
  run('server', 'build', 'watch-be', cb);
});

